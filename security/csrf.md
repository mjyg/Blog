# è·¨ç«™è¯·æ±‚ä¼ªé€ (CSRF)

è·¨ç«™è¯·æ±‚ä¼ªé€ (Cross-site request forgery)ï¼šæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨åŽ»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾
ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰,ç”±äºŽæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œ
æ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€ŒåŽ»è¿è¡Œ.

è·Ÿè·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰ç›¸æ¯”ï¼ŒXSS åˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRF åˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·ç½‘é¡µæµè§ˆå™¨çš„ä¿¡ä»»

## åŽŸç†
ç”¨æˆ·ç™»å½•å—ä¿¡ä»»çš„ç½‘ç«™Aï¼Œä¿å­˜ç”¨æˆ·ç™»é™†çŠ¶æ€ï¼Œç”Ÿæˆcookie
ç”¨æˆ·è®¿é—®å±é™©ç½‘ç«™Bï¼Œåœ¨Bä¸Šæœ‰è®¿é—®ç½‘ç«™Açš„æ“ä½œ(åˆ©ç”¨åŒæºç­–ç•¥ä¸é€‚ç”¨äºŽHTMLæ ‡ç­¾çš„ç¼ºé™·ï¼Œå¦‚imgæ ‡ç­¾çš„srcæ˜¯è®¿é—®Açš„æ“ä½œ)
æ­¤æ—¶æµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ä¸Šç”¨æˆ·çš„cookieï¼Œä»Žè€ŒAä¼šæ ¹æ®cookieä¿¡ä»»Bçš„è¯·æ±‚

## é˜²å¾¡æŽªæ–½
### Referer Check
æ ¹æ® HTTP åè®®ï¼Œåœ¨ HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œå®ƒè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚é€šè¿‡ Referer
 Checkï¼Œå¯ä»¥æ£€æŸ¥è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„"æº"ã€‚
 
æ¯”å¦‚ï¼Œå¦‚æžœç”¨æˆ·è¦åˆ é™¤è‡ªå·±çš„å¸–å­ï¼Œé‚£ä¹ˆå…ˆè¦ç™»å½• www.c.comï¼Œç„¶åŽæ‰¾åˆ°å¯¹åº”çš„é¡µé¢ï¼Œå‘èµ·åˆ é™¤å¸–å­çš„è¯·æ±‚ã€‚
æ­¤æ—¶ï¼ŒReferer çš„å€¼æ˜¯ www.c.comï¼›å½“è¯·æ±‚æ˜¯ä»Ž www.a.com å‘èµ·æ—¶ï¼ŒReferer çš„å€¼æ˜¯ www.a.com äº†ã€‚å› æ­¤ï¼Œ
è¦é˜²å¾¡ CSRF æ”»å‡»ï¼Œåªéœ€è¦å¯¹äºŽæ¯ä¸€ä¸ªåˆ å¸–è¯·æ±‚éªŒè¯å…¶ Referer å€¼ï¼Œå¦‚æžœæ˜¯ä»¥ www.c.com å¼€å¤´çš„åŸŸåï¼Œåˆ™è¯´æ˜Ž
è¯¥è¯·æ±‚æ˜¯æ¥è‡ªç½‘ç«™è‡ªå·±çš„è¯·æ±‚ï¼Œæ˜¯åˆæ³•çš„ã€‚å¦‚æžœ Referer æ˜¯å…¶ä»–ç½‘ç«™çš„è¯ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯ CSRF æ”»å‡»ï¼Œå¯ä»¥æ‹’ç»è¯¥è¯·æ±‚ã€‚

### æ·»åŠ  token éªŒè¯
å¦‚æžœè¦æ±‚åœ¨è®¿é—®æ•æ„Ÿæ•°æ®è¯·æ±‚æ—¶ï¼Œè¦æ±‚ç”¨æˆ·æµè§ˆå™¨æä¾›ä¸ä¿å­˜åœ¨cookieä¸­ï¼Œå¹¶ä¸”æ”»å‡»è€…æ— æ³•ä¼ªé€ çš„æ•°æ®ä½œä¸ºæ ¡éªŒï¼Œ
é‚£ä¹ˆæ”»å‡»è€…å°±æ— æ³•å†è¿è¡ŒCSRFæ”»å‡»ã€‚
å¯ä»¥åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯å»ºç«‹ä¸€ä¸ªæ‹¦æˆªå™¨æ¥éªŒè¯è¿™ä¸ª tokenï¼Œ
å¦‚æžœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºå¯èƒ½æ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚

ðŸŒº å‚è€ƒæ–‡ç« ï¼š
>* [ç»´åŸºç™¾ç§‘ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ](https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0)
>* [webå®‰å…¨ï¼šä»€ä¹ˆæ˜¯ XSS å’Œ CSRF](https://juejin.cn/post/6844903856443392014)

